<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="/static/slick/slick.css"/>
    <style>
        body { margin: 0; padding: 0; }
        #content {
            display: flex;
            /* make items stretch vertically */
            align-items: stretch;
            /* make it 100% of the vertical height of browser */
            height: 100vh;
        }
        #slider {
            background-color: black;
            width: 30%
        }
        #iframe {
            width: 100%;
        }

        #slider img {
            width: auto;
            margin: 0 auto;
            height: calc(100vh);
        }
    </style>
</head>
<body>
<!--
    <div class="control">
        <img id="video" src="{{ url_for('video_viewer') }}">
    </div>
    -->
<div id="content">
    <div id="slider">
        <div><img src="/static/img/f_1.jpg" alt=""/></div>
        <div><img src="/static/img/f_2.jpg" alt=""/></div>
    </div>
    <iframe id="iframe" src="/static/webshop.html"></iframe>
    <pre id="debug"></pre>
</div>

<script src="/static/jquery/jquery-1.11.0.min.js"></script>
<script src="/static/jquery/jquery-migrate-1.2.1.min.js"></script>
<script src="/static/slick/slick.min.js"></script>
<script type="text/javascript">
    function bubbleIframeMouseMove(iframe){
        // Save any previous onmousemove handler
        var existingOnMouseMove = iframe.contentWindow.onmousemove;

        // Attach a new onmousemove listener
        iframe.contentWindow.onmousemove = function(e){
            // Fire any existing onmousemove listener
            if(existingOnMouseMove) existingOnMouseMove(e);

            // Create a new event for the this window
            var evt = document.createEvent("MouseEvents");

            // We'll need this to offset the mouse move appropriately
            var boundingClientRect = iframe.getBoundingClientRect();

            // Initialize the event, copying exiting event values
            // for the most part
            evt.initMouseEvent(
                "mousemove",
                true, // bubbles
                false, // not cancelable
                window,
                e.detail,
                e.screenX,
                e.screenY,
                e.clientX + boundingClientRect.left,
                e.clientY + boundingClientRect.top,
                e.ctrlKey,
                e.altKey,
                e.shiftKey,
                e.metaKey,
                e.button,
                null // no related element
            );

            // Dispatch the mousemove event on the iframe element
            iframe.dispatchEvent(evt);
        };
    }

    $(document).ready(function() {
        // Get the iframe element we want to track mouse movements on
        var myIframe = document.getElementById("myIframe");

        // Run it through the function to setup bubbling
        bubbleIframeMouseMove(myIframe);
        const ws = new WebSocket("ws://localhost:5001/");
        const slides = [1, 2, 3];
        let slide = 2;
        ws.onopen = function () {
            ws.send("socket open");
        };
        ws.onclose = function (evt) {
            console.log("socket closed");
        };
        ws.onmessage = function (evt) {
            console.log('socket message', evt.data);
        };
        $('#slider').slick({
            infinite: true,
            speed: 300,
            autoplay: true,
            autoplaySpeed: 2000,
            slidesToShow: 1,
            arrows: false,
            dots: false,
        }).on('beforeChange', function(){
            $('#slider').slick('slickAdd', `
                <div><img src="/static/img/f_${slides[slide%slides.length]}.jpg" alt=""/></div>
            `);
            slide++;
        });
        let t;
        function resetTimer() {
            clearTimeout(t);
            t = setTimeout(function(){
                console.log('user has been inactive long enough');
            }, 3 * 1000)
        }
        document.onload = resetTimer;
        document.onmousemove = resetTimer;
        document.onmousedown = resetTimer; // touchscreen presses
        document.ontouchstart = resetTimer;
        document.onclick = resetTimer;     // touchpad clicks
        document.onscroll = resetTimer;    // scrolling with arrow keys
        document.onkeypress = resetTimer;
    });
</script>
</body>
</html>
